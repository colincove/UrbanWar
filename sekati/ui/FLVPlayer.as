/** * sekati.ui.FLVPlayer * @version 1.5.4 * @author jason m horwitz & steve baughman | sekati.com * Copyright (C) 2008-2009 jason m horwitz, Sekat LLC. All Rights Reserved. * Released under the MIT License: http://www.opensource.org/licenses/mit-license.php */package sekati.ui {	import sekati.events.MediaEvent;	import sekati.media.FLV;	import sekati.ui.AbstractMediaPlayer;	import flash.display.MovieClip;	import flash.display.Sprite;	import flash.media.Video;		/**	 * FLVPlayer provides playback control interface logic to be used with sekati.media.FLV.	 * 	 * <p>To implement pass references to UI controller instances to the <code>FLVPlayer</code> 	 * constructor, instantiate the FLVPlayer instance & <code>addChild( myFLVPlayerInstance )</code> 	 * to attach the sprite-wrapped <code>Video</code>.</p>	 * 	 * @example <listing version="3.0">	 * var player : FLVPlayer = new FLVPlayer( player.playBtn, player.progressBar, player.bufferBar, player.gutterBar, player.volumeBtn );	 * player.x = player.y = 10;	 * addChild( player ); // adds a sprite-wrapped video instance.	 * player.init( 'path/to/my.flv' );	 * </listing>	 * 	 * @see sekati.media.FLV	 * @see sekati.events.MediaEvent	 */	public class FLVPlayer extends AbstractMediaPlayer {		protected var _width : uint;		protected var _height : uint;		protected var _smoothing : Boolean;		protected var _currentCuePoint : Object;		/**		 * FLVPlayer Constructor		 * @param playBtn 		reference to play UI control.		 * @param progressBar	reference to progress UI to control.		 * @param bufferBar 	reference to buffer UI control.		 * @param gutterBar		reference to gutter UI to control.		 * @param volumeBtn 	reference to volume UI to control.		 * @param width 		of the <code>Video</code> instance.		 * @param height 		of the <code>Video</code> instance.		 * @param smoothing		of the <code>Video</code> instance.		 */		public function FLVPlayer(playBtn : MovieClip, progressBar : Sprite, bufferBar : Sprite, gutterBar : Sprite, volumeBtn : Sprite, width : uint = 320, height : uint = 240, smoothing : Boolean = true) {			super( playBtn, progressBar, bufferBar, gutterBar, volumeBtn );			_width = width;			_height = height;			_smoothing = smoothing;		}		// CORE CONTROLS				/**		 * Load video and initialize FLVPlayer UI and FLV core.		 * @param url 		of flv video.		 * @param buffer 	in seconds.		 */		override public function init(url : String, buffer : uint = 4) : void {			super.init( url, buffer );		}		/**		 * @inheritDoc		 */		override protected function createMedia() : void {			_media = new FLV( _width, _height, _smoothing );			addChild( _media['video'] );		}		/**		 * @inheritDoc		 */		override protected function addMediaListeners() : void {			super.addMediaListeners( );			_media.addEventListener( MediaEvent.START, statusHandler, false, 0, true );			_media.addEventListener( MediaEvent.COMPLETE, statusHandler, false, 0, true );			_media.addEventListener( MediaEvent.STREAM_NOT_FOUND, statusHandler, false, 0, true );			_media.addEventListener( MediaEvent.REBUFFER, statusHandler, false, 0, true );			_media.addEventListener( MediaEvent.REBUFFER_COMPLETE, statusHandler, false, 0, true );			_media.addEventListener( MediaEvent.METADATA, statusHandler, false, 0, true );			_media.addEventListener( MediaEvent.CUE_POINT, statusHandler, false, 0, true );		}		/**		 * @inheritDoc		 */		override protected function removeMediaListeners() : void {			super.removeMediaListeners( );			_media.removeEventListener( MediaEvent.START, statusHandler );			_media.removeEventListener( MediaEvent.COMPLETE, statusHandler );			_media.removeEventListener( MediaEvent.STREAM_NOT_FOUND, statusHandler );			_media.removeEventListener( MediaEvent.REBUFFER, statusHandler );			_media.removeEventListener( MediaEvent.REBUFFER_COMPLETE, statusHandler );			_media.removeEventListener( MediaEvent.METADATA, statusHandler );			_media.removeEventListener( MediaEvent.CUE_POINT, statusHandler );		}			// MOVIE HANDLERS					/**		 * @inheritDoc		 */		override protected function statusHandler(e : MediaEvent) : void {			super.statusHandler( e );			switch (e.type) {				case MediaEvent.BUFFER_EMPTY :					trace( "FLVPlayer-> MediaEvent: bufferEmpty" );					break;				case MediaEvent.BUFFER_FULL :					trace( "FLVPlayer-> MediaEvent: bufferFull" );					break;				case MediaEvent.BUFFER_FLUSH :					trace( "FLVPlayer-> MediaEvent: bufferFlush" );					break;				case MediaEvent.START :					trace( "FLVPlayer-> MediaEvent: start" );					break;				case MediaEvent.COMPLETE :					trace( "FLVPlayer-> MediaEvent: stop" );					if(_media.isPlaying) {						playBtnClick( );					}					break;				case MediaEvent.STREAM_NOT_FOUND :					trace( "FLVPlayer-> MediaEvent: play_streamNotFound" );					break;				case MediaEvent.SEEK_INVALID_TIME :					trace( "FLVPlayer-> MediaEvent: seek_invalidTime" );					_media.rewind( );					break;				case MediaEvent.SEEK_NOTIFY:					trace( "FLVPlayer-> MediaEvent: seek_notify" );					break;				case MediaEvent.REBUFFER:					trace( "FLVPlayer-> MediaEvent: rebuffer" );					break;				case MediaEvent.REBUFFER_COMPLETE:					trace( "FLVPlayer-> MediaEvent: rebufferComplete" );					break;					case MediaEvent.METADATA:					trace( "FLVPlayer-> MediaEvent: metaData" );					break;				case MediaEvent.CUE_POINT:					trace( "FLVPlayer-> MediaEvent: cuePoint" );					_currentCuePoint = e.cuePointData;					// if seeking don't report cuepoint info ...					if(!_isDrag || !_isSeeking) {						dispatchEvent( new MediaEvent( MediaEvent.CUE_POINT_DISPLAY, null, NaN, NaN, null, e.cuePointData ) );					}					break;					case MediaEvent.FILE_STRUCTURE_INVALID:					trace( "FLVPlayer-> MediaEvent: fileStructureInvalid" );					break;				case MediaEvent.NO_SUPPORTED_TRACK_FOUND:					trace( "FLVPlayer-> MediaEvent: noSupportedTrackFound" );					break;														default :					trace( "FLVPlayer-> MediaEvent: unrecognized status code: " + e.code + ", type: " + e.type );			}					}		// EVENT HANDLERS		/**		 * Returns reference to current cue point data object.		 */		public function get currentCuePoint() : Object {			return _currentCuePoint;		}		/**		 * The <code>FLV</code> being played.		 */		public function get movie() : FLV {			return (_media != null) ? _media as FLV : null;		}		/**		 * The <code>Video</code> instance.		 */		public function get video() : Video {			return (movie.video != null) ? movie.video : null;		}	}}