/** * sekati.external.ExternalMouseWheel * @version 1.0.5 * @author jason m horwitz | sekati.com * Copyright (C) 2008  jason m horwitz, Sekat LLC. All Rights Reserved. * Released under the MIT License: http://www.opensource.org/licenses/mit-license.php */package sekati.external {	import sekati.events.ExternalMouseEvent;	import sekati.external.ExternalBase;	import sekati.log.Logger;	import sekati.validators.OSValidator;		import flash.events.EventDispatcher;	import flash.events.TimerEvent;	import flash.utils.Timer;		/**	 * ExternalMouseWheel adds mouse wheel support for Mac clients:	 * This is accomplished via capturing the mouseWheel event in 	 * javascript with <code>ExternalInterface<code> and dispatching 	 * an <code>ExternalMouseWheelEvent<code>. These events will only	 * be dispatched if the client is a Mac.	 */	final public class ExternalMouseWheel extends EventDispatcher {		private static var _instance : ExternalMouseWheel;		/**		 * ExternalMouseWheel Singleton Constructor		 * @param $ SingletonEnforcer - internal to the AS file; the param prevents external instantiation without error.		 */		public function ExternalMouseWheel( $ : SingletonEnforcer = null) {			if (!$) {				throw new ArgumentError( "ExternalMouseWheel is a Singleton and may only be accessed via its accessor methods: 'getInstance()' or '$'." );				}			if (!OSValidator.isMac( )) {				throw new Error( "ExternalMouseWheel is not needed for non-mac clients." );				}			init( );		}		/**		 * Singleton Accessor		 * @return ExternalMouseWheel		 */		public static function getInstance() : ExternalMouseWheel {			if( _instance == null ) _instance = new ExternalMouseWheel( new SingletonEnforcer( ) );			return _instance;		}		/**		 * Shorthand singleton accessor getter		 * @return ExternalMouseWheel		 */		public static function get $() : ExternalMouseWheel {			return ExternalMouseWheel.getInstance( );			}		/**		 * Initialize.		 */		public function init() : void {			if(ExternalBase.isReady) {				try {					ExternalBase.safeAddCallback( "externalMouseEvent", externalMouseEvent );					if (!ExternalBase.isReady) {						//Logger.$.warn( this, "ExternalInterface is not yet available: will retry momentarily ..." );						var readyTimer : Timer = new Timer( 100, 10 );						readyTimer.addEventListener( TimerEvent.TIMER, timerHandler );						readyTimer.start( );					}				} catch (se : SecurityError) {					Logger.$.error( this, "init invoked Security Error: " + se.message );				} catch (e : Error) {					Logger.$.error( this, "init invoked Error: " + e.message );				}			}					}		protected function timerHandler(e : TimerEvent) : void {			if (ExternalBase.isReady) {				Logger.$.notice( this, "ExternalInterface became available." );				//trace( "ExternalInterface IS TOTALLY READY DUDE :-)" );				Timer( e.target ).stop( );			}		}		/**		 * Catch the callback from javascript and dispatch an ExternalMouseEvent to mac clients.		 * @param delta - mousewheel delta.		 */		protected function externalMouseEvent(delta : int) : void {			dispatchEvent( new ExternalMouseEvent( ExternalMouseEvent.MOUSE_WHEEL, delta ) );		}	}}/** * Internal class is accessible only to this AS file and is used  * as a constructor param to enforce proper Singleton behavior. */internal class SingletonEnforcer {}